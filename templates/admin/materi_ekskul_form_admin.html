{% extends "admin/layout_admin.html" %}

{% block title %}{{ action }} Materi Ekstrakurikuler{% endblock %}

{% block head_extra %}
<script>
    function toggleKontenFields() {
        console.log("Fungsi toggleKontenFields DIPANGGIL."); // DEBUG

        var tipeKontenSelect = document.getElementById('tipe_konten');
        if (!tipeKontenSelect) {
            console.error("ERROR: Elemen <select> dengan ID 'tipe_konten' TIDAK DITEMUKAN!");
            return;
        }
        var tipe = tipeKontenSelect.value;
        console.log("Tipe Konten yang dipilih:", tipe); // DEBUG

        var fieldFile = document.getElementById('field_file_konten');
        var fieldUrl = document.getElementById('field_path_konten_url');
        var fieldTeks = document.getElementById('field_isi_konten_teks');
        var fileInput = document.getElementById('file_konten'); // Input file di dalam fieldFile

        if (!fieldFile) console.error("ERROR: Div 'field_file_konten' TIDAK DITEMUKAN!");
        if (!fieldUrl) console.error("ERROR: Div 'field_path_konten_url' TIDAK DITEMUKAN!");
        if (!fieldTeks) console.error("ERROR: Div 'field_isi_konten_teks' TIDAK DITEMUKAN!");
        if (!fileInput) console.error("ERROR: Input file dengan ID 'file_konten' TIDAK DITEMUKAN!");


        if (fieldFile) {
            if (tipe === 'file') {
                fieldFile.style.display = 'block';
                console.log("field_file_konten seharusnya MUNCUL."); // DEBUG
            } else {
                fieldFile.style.display = 'none';
                console.log("field_file_konten seharusnya TERSEMBUNYI."); // DEBUG
            }
        }
        
        if (fieldUrl) {
            fieldUrl.style.display = (tipe === 'link' || tipe === 'video_embed') ? 'block' : 'none';
        }
        
        if (fieldTeks) {
            fieldTeks.style.display = (tipe === 'teks') ? 'block' : 'none';
        }

        // Mengatur atribut 'required' pada input file
        if (fileInput) {
            // '{{ action }}' akan dirender oleh Jinja menjadi "Tambah" atau "Edit"
            if (tipe === 'file' && '{{ action }}' === 'Tambah') {
                fileInput.required = true;
                console.log("Input file SEKARANG required."); // DEBUG
            } else {
                fileInput.required = false;
                console.log("Input file SEKARANG tidak required."); // DEBUG
            }
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        console.log("DOM sepenuhnya dimuat dan di-parse."); // DEBUG
        var tipeKontenSelect = document.getElementById('tipe_konten');
        if (tipeKontenSelect) { 
             console.log("Elemen 'tipe_konten' DITEMUKAN. Menambahkan event listener dan memanggil toggleKontenFields()."); // DEBUG
             toggleKontenFields(); // Panggil saat halaman dimuat
             tipeKontenSelect.addEventListener('change', toggleKontenFields); // Tambahkan event listener
        } else {
            console.error("ERROR saat DOMContentLoaded: Elemen <select> dengan ID 'tipe_konten' TIDAK DITEMUKAN!");
        }
    });
</script>
{% endblock %}

{# ... sisa template materi_ekskul_form_admin.html Anda ... #}
{# Pastikan ID elemen HTML Anda sudah benar: #}
{# <select class="form-select" id="tipe_konten" name="tipe_konten" required> ... </select> #}
{# <div id="field_file_konten" class="mb-3" style="display: none;"> #}
{#   <input type="file" class="form-control" id="file_konten" name="file_konten"> #}
{# </div> #}
{# <div id="field_path_konten_url" class="mb-3" style="display: none;"> ... </div> #}
{# <div id="field_isi_konten_teks" class="mb-3" style="display: none;"> ... </div> #}